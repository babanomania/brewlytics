worker_processes 1;

events { worker_connections 1024; }

http {
    upstream order_api {
        server order-api:8000;
    }
    upstream product_api {
        server product-api:8000;
    }
    upstream customer_api {
        server customer-api:8000;
    }

    server {
        listen 80;

        # preserve original host and port when proxying so backend redirects
        # contain the correct port instead of defaulting to 80
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off;

        location /orders/ {
            proxy_pass http://order_api/;
        }

        location /products/ {
            proxy_pass http://product_api/;
        }

        location /customers/ {
            proxy_pass http://customer_api/;
        }
    }
}
